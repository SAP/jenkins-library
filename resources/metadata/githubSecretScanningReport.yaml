metadata:
  name: githubSecretScanningReport
  description: Generates a report for GitHub secret scanning alerts for a specified GitHub repository.
  longDescription: |
    This step retrieves the secret scan report from your specified GitHub repository.
    It can be used to automate the fetching of reports for security audits, compliance checks,
    or general monitoring of secrets and sensitive information detected by GitHub.

    The fetched report can include details such as:

    * Line numbers and file names where potential secrets were detected
    * Types of secrets identified (e.g., credentials, tokens)
    * Severity levels of each detected secret
spec:
  inputs:
    secrets:
      - name: githubTokenCredentialsId
        description: Jenkins 'Secret text' credentials ID containing token to authenticate to GitHub.
        type: jenkins
    params:
      - name: apiUrl
        aliases:
          - name: githubApiUrl
        description: Set the GitHub API url.
        scope:
          - GENERAL
          - PARAMETERS
          - STAGES
          - STEPS
        type: string
        default: https://api.github.com
        mandatory: true
      - name: owner
        aliases:
          - name: githubOrg
        description: Name of the GitHub organization.
        resourceRef:
          - name: commonPipelineEnvironment
            param: github/owner
        scope:
          - GENERAL
          - PARAMETERS
          - STAGES
          - STEPS
        type: string
        mandatory: true
      - name: repository
        aliases:
          - name: githubRepo
        description: Name of the GitHub repository.
        resourceRef:
          - name: commonPipelineEnvironment
            param: github/repository
        scope:
          - GENERAL
          - PARAMETERS
          - STAGES
          - STEPS
        type: string
        mandatory: true
      - name: token
        aliases:
          - name: githubToken
          - name: access_token
        description: "GitHub personal access token as per https://help.github.com/en/github/authenticating-to-github/creating-a-personal-access-token-for-the-command-line"
        scope:
          - GENERAL
          - PARAMETERS
          - STAGES
          - STEPS
        type: string
        mandatory: true
        secret: true
        resourceRef:
          - name: githubTokenCredentialsId
            type: secret
          - type: vaultSecret
            default: github
            name: githubVaultSecretName
  outputs:
    resources:
      - name: reports
        type: reports
        params:
          - filePattern: "**/github-secretscanning.report.json"
            type: secretscanning
