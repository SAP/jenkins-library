metadata:
  name: onapsisExecuteScan
  description: Execute a scan with Onapsis Control
  longDescription: This step executes a scan with Onapsis Control.
spec:
  inputs:
    secrets:
      - name: onapsisPassword
        type: jenkins
        description: "Onapsis password for JWT authentication"
        mandatory: true
    params:
      - name: scanServiceUrl
        type: string
        description: URL of the scan service
        mandatory: true
        scope:
          - PARAMETERS
          - STAGES
          - STEPS
        resourceRef:
          - name: scanServiceUrl
            type: secret
      - name: scanGitUrl
        type: string
        description: "The target git repo to scan"
        scope:
          - PARAMETERS
          - STAGES
          - STEPS
      - name: scanGitBranch
        type: string
        description: "The target git branch to scan"
        scope:
          - PARAMETERS
          - STAGES
          - STEPS
      - name: onapsisUsername
        type: string
        description: "Onapsis username for JWT authentication"
        mandatory: true
        scope:
          - PARAMETERS
          - STAGES
          - STEPS
        resourceRef:
          - name: onapsisUsername
            type: secret
      - name: onapsisPassword
        type: string
        description: "Onapsis password for JWT authentication"
        mandatory: true
        scope:
          - PARAMETERS
          - STAGES
          - STEPS
        resourceRef:
          - name: onapsisPassword
            type: secret
      - name: accessToken
        type: string
        description: "Token used to authenticate with the Control Scan Service"
        scope:
          - PARAMETERS
          - STAGES
          - STEPS
        secret: true
        resourceRef:
          - name: onapsisTokenCredentialsId
            type: secret
      - name: appType
        type: string
        description: "Type of the application to be scanned"
        default: "SAPUI5"
        scope:
          - PARAMETERS
          - STAGES
          - STEPS
        possibleValues:
          - "ABAP"
          - "SAPUI5"
      - name: failOnMandatoryFinding
        type: bool
        description: "Fail the build if mandatory findings are detected"
        default: true
        scope:
          - PARAMETERS
          - STAGES
          - STEPS
      - name: failOnOptionalFinding
        type: bool
        description: "Fail the build if optional findings are detected"
        default: false
        scope:
          - PARAMETERS
          - STAGES
          - STEPS
      - name: onapsisCertificatePath
        type: string
        description: "The path to the Onapsis scan server certificate"
        scope:
          - PARAMETERS
          - STAGES
          - STEPS
      - name: debugMode
        type: bool
        description: "Enable debug mode for the scan"
        default: false
        scope:
          - PARAMETERS
          - STAGES
          - STEPS
