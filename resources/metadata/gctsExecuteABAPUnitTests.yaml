metadata:
  name: gctsExecuteABAPUnitTests
  description: Runs ABAP unit tests and ATC (ABAP Test Cockpit) checks for a specified object scope.
  longDescription: |
    This step executes ABAP unit test and ATC checks for a specified scope of objects that exist in a local Git repository on an ABAP system.

spec:
  inputs:
    secrets:
      - name: abapCredentialsId
        description: ID taken from the Jenkins credentials store containing user name and password of the user that authenticates to the ABAP system on which you want to execute the checks.
        type: jenkins
    params:
      - name: username
        type: string
        description: User that authenticates to the ABAP system. Note - Don´t provide this parameter directly. Either set it in the environment, or in the Jenkins credentials store, and provide the ID as value of the `abapCredentialsId` parameter.
        scope:
          - PARAMETERS
          - STAGES
          - STEPS
        mandatory: true
        secret: true
        resourceRef:
          - name: abapCredentialsId
            type: secret
            param: username
      - name: password
        type: string
        description: Password of the ABAP user that authenticates to the ABAP system. Note - Don´t provide this parameter directly. Either set it in the environment, or in the Jenkins credentials store, and provide the ID as value of the `abapCredentialsId` parameter.
        scope:
          - PARAMETERS
          - STAGES
          - STEPS
        mandatory: true
        secret: true
        resourceRef:
          - name: abapCredentialsId
            type: secret
            param: password
      - name: host
        type: string
        description: Protocol and host of the ABAP system, including the port. Please provide it in the format `<protocol>://<host>:<port>`. Supported protocols are `http` and `https`.
        scope:
          - PARAMETERS
          - STAGES
          - STEPS
        mandatory: true
      - name: repository
        type: string
        description: Name (ID) of the local repository on the ABAP system
        scope:
          - PARAMETERS
          - STAGES
          - STEPS
        mandatory: true
      - name: client
        type: string
        description: Client of the ABAP system in which you want to execute the checks
        scope:
          - PARAMETERS
          - STAGES
          - STEPS
        mandatory: true
      - name: aUnitTest
        type: bool
        default: true
        description: |
         Indication whether you want to execute the ABAP Unit tests. If the ABAP Unit tests fail, the results are mapped as follows to the statuses available in the Jenkins plugin. (Successful ABAP unit test results are not displayed.)
            * Failed with severity 'fatal' is displayed as Error
            * Failed with severity 'critical' is displayed as Error
            * Failed with severity 'warning' is displayed as Warning
        scope:
          - PARAMETERS
          - STAGES
          - STEPS
      - name: atcCheck
        type: bool
        default: true
        description: |
          Indication whether you want to execute the ATC checks. If the ATC checks result in errors with priorities 1 and 2, they are considered as failed. The results are mapped as follows to the statuses available in the Jenkins plugin. (Successful ATC check results are not displayed.)
            * Priority 1 and 2 are displayed as Error
            * Priority 3 is displayed as Warning
        scope:
          - PARAMETERS
          - STAGES
          - STEPS
      - name: atcVariant
        type: string
        default: "DEFAULT"
        description: Variant to be used for the ATC checks.
        scope:
          - PARAMETERS
          - STAGES
          - STEPS
      - name: scope
        type: string
        default: repository
        enum:
          - localChangedObjects
          - remoteChangedObjects
          - localChangedPackages
          - remoteChangedPackages
          - repository
          - packages
        description: |
           Scope of objects for which you want to execute the checks:

            * `localChangedObjects` - Object delta derived from last activity in the local repository. The checks are executed for the individual objects.
            * `remoteChangedObjects` - Object delta between the commit that triggered the pipeline and the current commit in the remote repository. The checks are executed for the individual objects.
            * `localChangedPackages` - Object delta derived from last activity in the local repository. All objects are resolved into packages. The checks are executed for the packages.
            * `remoteChangedPackages` - Object delta between the commit that triggered the pipeline and the current commit in the remote repository. All objects are resolved into packages. The checks are executed for the packages.
            * `repository` - All objects that are part of the local repository. The checks are executed for the individual objects. Packages (DEVC) are excluded. This is the default scope.
            * `packages` - All packages that are part of the local repository. The checks are executed for the packages.
        scope:
          - PARAMETERS
          - STAGES
          - STEPS
      - name: commit
        type: string
        description: ID of the commit that triggered the pipeline or any other commit to compare objects. For scopes `remoteChangedObjects` and `remoteChangedPackages` specifying a commit is mandatory.
        scope:
          - PARAMETERS
          - STAGES
          - STEPS
        mandatory: false
      - name: workspace
        type: string
        description: Absolute path to directory which contains the source code that your CI/CD tool checks out. For example in Jenkins, the workspace parameter is `/var/jenkins_home/workspace/<jobName>/`. As an alternative, you can use Jenkins's predefined environmental variable WORKSPACE.
        scope:
          - PARAMETERS
          - STAGES
          - STEPS
        mandatory: true
      - name: atcResultsFileName
        type: string
        description: Specifies the output file name for the results of the ATC checks.
        scope:
          - PARAMETERS
          - STAGES
          - STEPS
        mandatory: false
        default: "ATCResults.xml"
      - name: aUnitResultsFileName
        type: string
        description: Specifies the output file name for the results of the AUnit tests.
        scope:
          - PARAMETERS
          - STAGES
          - STEPS
        mandatory: false
        default: "AUnitResults.xml"
