metadata:
  name: contrastExecuteScan
  description: This step executes a contrast scan on the specified project.
  longDescription: |-
    This step executes a contrast scan on the specified project.

spec:
  inputs:
    secrets:
      - name: userCredentialsId
        description: "Jenkins 'Username with password' credentials ID containing username and user API Key to communicate with the Contrast server."
        type: jenkins
      - name: serviceKeyCredentialsId
        description: "Jenkins 'Secret text' credentials ID containing service key to communicate with the Contrast server."
        type: jenkins
    params:
      - name: userApiKey
        description: "User API Key for authorizing access to Contrast."
        scope:
          - PARAMETERS
          - STAGES
          - STEPS
        type: string
        secret: true
        resourceRef:
          - name: userCredentialsId
            type: secret
            param: userApiKey
          - type: vaultSecret
            default: contrast
            name: userApiKey
      - name: serviceKey
        description: "Service Key for authorization access to Contrast."
        scope:
          - PARAMETERS
          - STAGES
          - STEPS
        type: string
        secret: true
        aliases:
          - name: service_key
        resourceRef:
          - name: serviceKeyCredentialsId
            type: secret
          - type: vaultSecret
            default: contrast
            name: serviceKey
      - name: username
        description: "Username or email to use for authorization access to Contrast."
        scope:
          - PARAMETERS
          - STAGES
          - STEPS
        type: string
        secret: true
        resourceRef:
          - name: userCredentialsId
            type: secret
            param: username
          - type: vaultSecret
            default: contrast
            name: username
      - name: server
        type: string
        description: "Contrast server url."
        scope:
          - PARAMETERS
          - STAGES
          - STEPS
      - name: organizationId
        type: string
        description: "Organization Id in Contrast."
        scope:
          - PARAMETERS
          - STAGES
          - STEPS
      - name: applicationId
        type: string
        description: "Application Id in Contrast."
        scope:
          - PARAMETERS
          - STAGES
          - STEPS
      - name: vulnerabilityThresholdTotal
        description: "Threshold for maximum number of allowed vulnerabilities."
        type: int
        default: 0
        scope:
          - PARAMETERS
          - STAGES
          - STEPS
      - name: checkForCompliance
        description: "If set to true, the piper step checks for compliance based on vulnerability thresholds. Example - If total vulnerabilities are 10 and vulnerabilityThresholdTotal is set as 0, then the steps throws an compliance error."
        type: bool
        default: false
        scope:
          - PARAMETERS
          - STAGES
          - STEPS
