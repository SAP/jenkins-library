metadata:
  name: contrastExecuteScan
  longDescription: |-
    This step evaluates if the audit requirements for Contrast Assess have been fulfilled after the execution of security tests by Contrast Assess. For further information on the tool, please consult the [documentation](https://github.wdf.sap.corp/pages/Security-Testing/doc/contrast/introduction/).
spec:
  inputs:
    secrets:
      - name: userCredentialsId
        description: "Jenkins 'Username with password' credentials ID containing username and user API Key to communicate with the Contrast server."
        type: jenkins
      - name: serviceKeyCredentialsId
        description: "Jenkins 'Secret text' credentials ID containing service key to communicate with the Contrast server."
        type: jenkins
    resources:
      - name: buildDescriptor
        type: stash
      - name: tests
        type: stash
    params:
      - name: userApiKey
        description: "User API Key for authorizing access to Contrast."
        scope:
          - PARAMETERS
          - STAGES
          - STEPS
        type: string
        secret: true
        resourceRef:
          - name: userCredentialsId
            type: secret
            param: userApiKey
          - type: vaultSecret
            default: contrast
            name: userApiKey
      - name: serviceKey
        description: "Service Key for authorization access to Contrast."
        scope:
          - PARAMETERS
          - STAGES
          - STEPS
        type: string
        secret: true
        aliases:
          - name: service_key
        resourceRef:
          - name: serviceKeyCredentialsId
            type: secret
          - type: vaultSecret
            default: contrast
            name: serviceKey
      - name: username
        description: "Username or email to use for authorization access to Contrast."
        scope:
          - PARAMETERS
          - STAGES
          - STEPS
        type: string
        secret: true
        resourceRef:
          - name: userCredentialsId
            type: secret
            param: username
          - type: vaultSecret
            default: contrast
            name: username
      - name: server
        type: string
        description: "Contrast server url."
        scope:
          - PARAMETERS
          - STAGES
          - STEPS
      - name: organizationId
        type: string
        description: "Organization Id in Contrast."
        scope:
          - PARAMETERS
          - STAGES
          - STEPS
      - name: applicationId
        type: string
        description: "Application Id in Contrast."
        scope:
          - PARAMETERS
          - STAGES
          - STEPS
      - name: vulnerabilityThresholdTotal
        description: "Threshold for maximum number of allowed vulnerabilities."
        type: int
        default: 0
        scope:
          - PARAMETERS
          - STAGES
          - STEPS
      - name: checkForCompliance
        description: "If set to true, the piper step checks for compliance based on vulnerability thresholds. Example - If total vulnerabilities are 10 and vulnerabilityThresholdTotal is set as 0, then the steps throws an compliance error."
        type: bool
        default: false
        scope:
          - PARAMETERS
          - STAGES
          - STEPS
